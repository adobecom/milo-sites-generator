{"version":3,"file":"delayed-Dqnzx7Zf.js","sources":["../../src/scripts/gtm-helper.js","../../src/scripts/delayed.js"],"sourcesContent":["/* eslint-disable import/prefer-default-export */\nimport { fetchPlaceholders } from './aem.js';\nimport { IS_AUTHOR_MODE } from './constants.js';\n\n// Constants for placeholder keys\nconst PLACEHOLDER_KEYS = {\n  GTM_ID: 'gtmid',\n  GTM_AUTH_PARAMS: 'gtmauthparams',\n  GTM_URL: 'gtmurl',\n};\n\n// Default GTM URL if not provided in placeholders\nconst DEFAULT_GTM_IFRAME_URL = 'https://www.googletagmanager.com/ns.html';\nconst DEFAULT_GTM_SCRIPT_URL = 'https://www.googletagmanager.com/gtm.js';\n\n// Configuration object\nconst gtmConfig = { data: null };\n\n/**\n * Creates the GTM initialization script\n * @param {string} gtmId - The GTM ID\n * @param {string} gtmScriptUrl - The GTM script URL\n * @param {string} authParams - Optional authentication parameters\n * @returns {string} The GTM script as a string\n */\nfunction getGtmScript(gtmId, gtmScriptUrl, authParams = '') {\n  return `\n    (function(w, d, s, l, i) {\n        w[l] = w[l] || [];\n        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); \n        var f = d.getElementsByTagName(s)[0],\n            j = d.createElement(s),\n            dl = l !== 'dataLayer' ? '&l=' + l : ''; \n        j.async = true;\n        j.src = '${(`${gtmScriptUrl}/gtm.js`) || DEFAULT_GTM_SCRIPT_URL}?id=' + i + dl + '${authParams}';\n        f.parentNode.insertBefore(j, f);\n    })(window, document, 'script', 'dataLayer', '${gtmId}');\n  `;\n}\n\n/**\n * Inserts a noscript fallback for GTM\n * @param {string} gtmId - The GTM ID\n * @param {string} gtmUrl - The GTM script URL\n * @param {string} authParams - Optional authentication parameters\n */\nfunction insertGtmNoscriptFallback(gtmId, gtmUrl, authParams = '') {\n  const noscriptTag = document.createElement('noscript');\n  const iframe = document.createElement('iframe');\n\n  iframe.setAttribute(\n    'src',\n    `${`${gtmUrl}/ns.html` || DEFAULT_GTM_IFRAME_URL}?id=${gtmId}${authParams}`,\n  );\n  iframe.setAttribute('height', '0');\n  iframe.setAttribute('width', '0');\n  iframe.style.display = 'none';\n  iframe.style.visibility = 'hidden';\n\n  noscriptTag.appendChild(iframe);\n  document.body.insertAdjacentElement('afterbegin', noscriptTag);\n}\n\n/**\n * Loads Google Tag Manager using configuration from placeholders\n */\n// eslint-disable-next-line consistent-return\nexport const loadGTM = async () => {\n  // Skip GTM loading in author mode\n  if (IS_AUTHOR_MODE) return false;\n  try {\n    // Load placeholder data if not already loaded\n    if (!gtmConfig.data) {\n      gtmConfig.data = await fetchPlaceholders();\n    }\n\n    // Extract GTM configuration values\n    const gtmId = gtmConfig.data[PLACEHOLDER_KEYS.GTM_ID];\n    const authParams = gtmConfig.data[PLACEHOLDER_KEYS.GTM_AUTH_PARAMS] || '';\n    const gtmUrl = gtmConfig.data[PLACEHOLDER_KEYS.GTM_URL] || DEFAULT_GTM_SCRIPT_URL;\n\n    // Exit if no GTM ID is provided\n    if (!gtmId) {\n      // eslint-disable-next-line no-console\n      console.info('GTM ID not provided, skipping GTM initialization');\n      // eslint-disable-next-line consistent-return\n      return;\n    }\n\n    // Insert GTM script\n    const script = document.createElement('script');\n    script.textContent = getGtmScript(gtmId, gtmUrl, authParams);\n    document.head.appendChild(script);\n\n    // Insert noscript fallback\n    insertGtmNoscriptFallback(gtmId, gtmUrl, authParams);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Failed to load GTM:', error);\n  }\n};\n","import { loadGTM } from './gtm-helper.js';\n\n// add delayed functionality here\nloadGTM();\n"],"names":["PLACEHOLDER_KEYS","DEFAULT_GTM_IFRAME_URL","DEFAULT_GTM_SCRIPT_URL","gtmConfig","getGtmScript","gtmId","gtmScriptUrl","authParams","insertGtmNoscriptFallback","gtmUrl","noscriptTag","iframe","loadGTM","IS_AUTHOR_MODE","fetchPlaceholders","script","error"],"mappings":"6EAKA,MAAMA,EAAmB,CACvB,OAAQ,QACR,gBAAiB,gBACjB,QAAS,QACX,EAGMC,EAAyB,2CACzBC,EAAyB,0CAGzBC,EAAY,CAAE,KAAM,IAAM,EAShC,SAASC,EAAaC,EAAOC,EAAcC,EAAa,GAAI,CAC1D,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAQW,GAAGD,CAAY,WAAcJ,CAAsB,qBAAqBK,CAAU;AAAA;AAAA,mDAEnDF,CAAK;AAAA,GAExD,CAQA,SAASG,EAA0BH,EAAOI,EAAQF,EAAa,GAAI,CACjE,MAAMG,EAAc,SAAS,cAAc,UAAU,EAC/CC,EAAS,SAAS,cAAc,QAAQ,EAE9CA,EAAO,aACL,MACA,GAAG,GAAGF,CAAM,YAAcR,CAAsB,OAAOI,CAAK,GAAGE,CAAU,EAC1E,EACDI,EAAO,aAAa,SAAU,GAAG,EACjCA,EAAO,aAAa,QAAS,GAAG,EAChCA,EAAO,MAAM,QAAU,OACvBA,EAAO,MAAM,WAAa,SAE1BD,EAAY,YAAYC,CAAM,EAC9B,SAAS,KAAK,sBAAsB,aAAcD,CAAW,CAC/D,CAMO,MAAME,EAAU,SAAY,CAEjC,GAAIC,EAAgB,MAAO,GAC3B,GAAI,CAEGV,EAAU,OACbA,EAAU,KAAO,MAAMW,EAAmB,GAI5C,MAAMT,EAAQF,EAAU,KAAKH,EAAiB,MAAM,EAC9CO,EAAaJ,EAAU,KAAKH,EAAiB,eAAe,GAAK,GACjES,EAASN,EAAU,KAAKH,EAAiB,OAAO,GAAKE,EAG3D,GAAI,CAACG,EAAO,CAEV,QAAQ,KAAK,kDAAkD,EAE/D,MACN,CAGI,MAAMU,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,YAAcX,EAAaC,EAAOI,EAAQF,CAAU,EAC3D,SAAS,KAAK,YAAYQ,CAAM,EAGhCP,EAA0BH,EAAOI,EAAQF,CAAU,CACpD,OAAQS,EAAO,CAEd,QAAQ,MAAM,sBAAuBA,CAAK,CAC9C,CACA,ECjGAJ,EAAS"}