{"version":3,"file":"facebook-feed.js","sources":["../../src/blocks/facebook-feed/facebook-feed.js"],"sourcesContent":["import 'nsw-design-system/src/components/card/_card.scss';\nimport { fetchPlaceholders } from '../../scripts/aem.js';\nimport './facebook-feed.scss';\n\nconst FB_PLACEHOLDER_KEY = 'facebookapi';\nconst LOCAL_DUMMY_JSON = '/src/blocks/facebook-feed/fbApi.json';\n\n// The API temporarily requires a bearer token to access the Facebook API.\n// In the future, it will require no authentication\nconst FB_HEADERS = {\n  headers: {\n    Authorization: 'Bearer ZmFjZWJvb2stc3dzLWF1dGhvcml6ZXItc3dzLWNsb3VkOktlbm5ldGhTV1M=',\n    'Content-Type': 'application/json',\n  },\n};\n\nasync function getFacebookApiPath() {\n  const isLocalhost = window.location.hostname === 'localhost';\n\n  try {\n    const response = await fetchPlaceholders();\n\n    if (isLocalhost && (!response || !response[FB_PLACEHOLDER_KEY])) {\n      return LOCAL_DUMMY_JSON;\n    }\n\n    return response[FB_PLACEHOLDER_KEY];\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Error fetching placeholders:', error);\n    return undefined;\n  }\n}\n\nasync function fetchFacebookPosts() {\n  return new Promise((resolve) => {\n    // Resolve immediately with null to prevent blocking\n    resolve(null);\n    \n    // Start the fetch process asynchronously\n    (async () => {\n      const fbApi = await getFacebookApiPath();\n      \n      if (!fbApi) {\n        return;\n      }\n      \n      try {\n        const fbResponse = await fetch(fbApi, {\n          method: 'GET',\n          ...FB_HEADERS,\n        });\n        \n        if (!fbResponse.ok) {\n          throw new Error(`Facebook API request failed: ${fbResponse.statusText}`);\n        }\n        \n        const fbPosts = await fbResponse.json();\n        \n        if (!fbPosts || !fbPosts.length || !fbPosts[0].posts) {\n          throw new Error('No Facebook posts found');\n        }\n        \n        const posts = JSON.parse(fbPosts[0].posts);\n        \n        const top3PostsWithImage = [];\n        for (let i = 0; i < posts.length; i += 1) {\n          const item = posts[i];\n          if (item.full_picture && item.message) {\n            top3PostsWithImage.push(item);\n            if (top3PostsWithImage.length === 3) break;\n          }\n        }\n        \n        // Update the UI with the fetched posts\n        updateFacebookFeed(top3PostsWithImage);\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('Error fetching Facebook API:', error);\n      }\n    })();\n  });\n}\n\n// New function to update the Facebook feed with posts\nfunction updateFacebookFeed(posts) {\n  if (!posts || !posts.length) return;\n  \n  const block = document.querySelector('.facebook-feed');\n  if (!block) return;\n  \n  const fbPostsEl = posts.map((post) => `<div class = 'nsw-col nsw-col-md-6 nsw-col-lg-4'>\n      <div class = 'nsw-card nsw-card--highlight'>\n        <div class=\"nsw-card__image\">\n        <img src=\"${post.full_picture}\" alt=\"Facebook post image\">\n        </div>\n        <div class=\"nsw-card__content\">\n          <div class=\"nsw-card__copy\">\n            <p>\n              <a href='https://www.facebook.com/${post.id}'>${post.message}</a>\n            </p>\n          </div>\n          <div class='card-icon'>\n            <svg width=\"24\" height=\"24\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path fill=\"#1578f2\" d=\"M32 16.098C32 7.207 24.837 0 16 0S0 7.207 0 16.098C0 24.133 5.851 30.793 13.5 32V20.751H9.437v-4.653H13.5v-3.547c0-4.035 2.389-6.263 6.043-6.263 1.751 0 3.582.314 3.582.314v3.962h-2.018c-1.988 0-2.607 1.241-2.607 2.514v3.02h4.438l-.709 4.653h-3.728V32c7.649-1.208 13.5-7.867 13.5-15.902z\"/></svg>\n          </div>\n          <span class=\"material-icons nsw-material-icons\" focusable=\"false\" aria-hidden=\"true\">east</span>\n        </div>\n      </div>\n    </div>`);\n  \n  const nswGrid = document.createElement('div');\n  nswGrid.classList.add('nsw-grid');\n  nswGrid.innerHTML = fbPostsEl.join('');\n  \n  // Clear and update the block\n  block.textContent = '';\n  block.append(nswGrid);\n}\n\nexport default async function decorate(block) {\n  // Add a class to the block for easy identification\n  block.classList.add('facebook-feed');\n  \n  // Create a loading state or placeholder\n  const loadingEl = document.createElement('div');\n  loadingEl.classList.add('nsw-grid');\n  loadingEl.innerHTML = `<div class=\"nsw-col nsw-col-md-12\">\n    <p>Loading Facebook posts...</p>\n  </div>`;\n  \n  block.textContent = '';\n  block.append(loadingEl);\n  \n  // Fetch posts asynchronously (this will return immediately)\n  await fetchFacebookPosts();\n}\n"],"names":["FB_PLACEHOLDER_KEY","LOCAL_DUMMY_JSON","FB_HEADERS","getFacebookApiPath","isLocalhost","response","fetchPlaceholders","error","fetchFacebookPosts","resolve","fbApi","fbResponse","fbPosts","posts","top3PostsWithImage","i","item","updateFacebookFeed","block","fbPostsEl","post","nswGrid","decorate","loadingEl"],"mappings":"kFAIA,MAAMA,EAAqB,cACrBC,EAAmB,uCAInBC,EAAa,CACjB,QAAS,CACP,cAAe,sEACf,eAAgB,kBACjB,CACH,EAEA,eAAeC,GAAqB,CAClC,MAAMC,EAAc,OAAO,SAAS,WAAa,YAEjD,GAAI,CACF,MAAMC,EAAW,MAAMC,EAAmB,EAE1C,OAAIF,IAAgB,CAACC,GAAY,CAACA,EAASL,CAAkB,GACpDC,EAGFI,EAASL,CAAkB,CACnC,OAAQO,EAAO,CAEd,QAAQ,MAAM,+BAAgCA,CAAK,EACnD,MACJ,CACA,CAEA,eAAeC,GAAqB,CAClC,OAAO,IAAI,QAASC,GAAY,CAE9BA,EAAQ,IAAI,GAGX,SAAY,CACX,MAAMC,EAAQ,MAAMP,EAAoB,EAExC,GAAKO,EAIL,GAAI,CACF,MAAMC,EAAa,MAAM,MAAMD,EAAO,CACpC,OAAQ,MACR,GAAGR,CACb,CAAS,EAED,GAAI,CAACS,EAAW,GACd,MAAM,IAAI,MAAM,gCAAgCA,EAAW,UAAU,EAAE,EAGzE,MAAMC,EAAU,MAAMD,EAAW,KAAM,EAEvC,GAAI,CAACC,GAAW,CAACA,EAAQ,QAAU,CAACA,EAAQ,CAAC,EAAE,MAC7C,MAAM,IAAI,MAAM,yBAAyB,EAG3C,MAAMC,EAAQ,KAAK,MAAMD,EAAQ,CAAC,EAAE,KAAK,EAEnCE,EAAqB,CAAE,EAC7B,QAASC,EAAI,EAAGA,EAAIF,EAAM,OAAQE,GAAK,EAAG,CACxC,MAAMC,EAAOH,EAAME,CAAC,EACpB,GAAIC,EAAK,cAAgBA,EAAK,UAC5BF,EAAmB,KAAKE,CAAI,EACxBF,EAAmB,SAAW,GAAG,KAEjD,CAGQG,EAAmBH,CAAkB,CACtC,OAAQP,EAAO,CAEd,QAAQ,MAAM,+BAAgCA,CAAK,CAC3D,CACA,GAAQ,CACR,CAAG,CACH,CAGA,SAASU,EAAmBJ,EAAO,CACjC,GAAI,CAACA,GAAS,CAACA,EAAM,OAAQ,OAE7B,MAAMK,EAAQ,SAAS,cAAc,gBAAgB,EACrD,GAAI,CAACA,EAAO,OAEZ,MAAMC,EAAYN,EAAM,IAAKO,GAAS;AAAA;AAAA;AAAA,oBAGpBA,EAAK,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,kDAKaA,EAAK,EAAE,KAAKA,EAAK,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAS/D,EAEHC,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAU,IAAI,UAAU,EAChCA,EAAQ,UAAYF,EAAU,KAAK,EAAE,EAGrCD,EAAM,YAAc,GACpBA,EAAM,OAAOG,CAAO,CACtB,CAEe,eAAeC,EAASJ,EAAO,CAE5CA,EAAM,UAAU,IAAI,eAAe,EAGnC,MAAMK,EAAY,SAAS,cAAc,KAAK,EAC9CA,EAAU,UAAU,IAAI,UAAU,EAClCA,EAAU,UAAY;AAAA;AAAA,UAItBL,EAAM,YAAc,GACpBA,EAAM,OAAOK,CAAS,EAGtB,MAAMf,EAAoB,CAC5B"}