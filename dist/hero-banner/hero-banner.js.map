{"version":3,"file":"hero-banner.js","sources":["../../src/blocks/hero-banner/hero-banner.js"],"sourcesContent":["import { createOptimizedPicture } from '../../scripts/aem.js';\nimport { moveInstrumentation } from '../../scripts/scripts.js';\nimport 'nsw-design-system/src/components/card/_card.scss';\nimport './hero-banner.scss';\n\n// TODO: Use the card styling for the hero content, rather than rebuilding\n// the same styles.\nconst CUSTOM_CLASSES = {\n  content: {\n    0: 'nsw-card__title',\n    1: 'nsw-card__copy',\n  },\n  image: {\n    0: 'hero__image__desktop',\n    1: 'hero__image__mobile',\n  },\n};\n\nfunction createWrapper(className) {\n  const wrapper = document.createElement('div');\n  wrapper.classList.add(className);\n  return wrapper;\n}\n\n/**\n * Creates a card wrapper with predefined classes.\n * @returns {object} An object containing `cardWrapper` and `cardContentWrapper`.\n */\nfunction createCardWrapper() {\n  const cardWrapper = createWrapper('nsw-card');\n  cardWrapper.classList.add('nsw-card--highlight');\n\n  const cardContentWrapper = createWrapper('nsw-card__content');\n  return { cardWrapper, cardContentWrapper };\n}\n\nfunction handleTitle(titleRow, bodyWrapper) {\n  const titleColumn = titleRow.firstElementChild;\n  if (!titleColumn) return;\n\n  titleColumn.classList.add(CUSTOM_CLASSES.content[0]);\n  const anchor = titleRow.querySelector('a');\n  const redirectUrl = anchor?.getAttribute('href') || '';\n\n  if (redirectUrl === '#' || redirectUrl === '') {\n    const titleEl = document.createElement('h4');\n    titleEl.innerHTML = anchor?.innerHTML || '';\n    moveInstrumentation(anchor, titleEl);\n    bodyWrapper.appendChild(titleEl);\n  } else {\n    bodyWrapper.appendChild(titleColumn);\n  }\n}\n\nfunction handleDescription(descriptionRow, bodyWrapper) {\n  const descriptionColumn = descriptionRow.firstElementChild;\n  if (!descriptionColumn) return;\n  moveInstrumentation(descriptionRow.querySelector('p'), descriptionColumn);\n  descriptionColumn.classList.add(CUSTOM_CLASSES.content[1]);\n  bodyWrapper.appendChild(descriptionColumn);\n}\n\nfunction processImages(heroImage) {\n  const imageWrapper = createWrapper('hero__image');\n  const paragraphs = [...heroImage.querySelectorAll('p')];\n  const pictures = [...heroImage.querySelectorAll('picture')];\n\n  // Handle alt text (text after the last picture)\n  const hasTextParagraph = paragraphs.length > 2\n    || (paragraphs.length === 2 && !paragraphs.every((p) => p.querySelector('picture')));\n  const lastParagraph = hasTextParagraph ? paragraphs.at(-1) : null;\n  const altText = lastParagraph?.innerText.trim() || '';\n\n  if (altText) {\n    pictures.forEach((picture) => {\n      picture.querySelector('img')?.setAttribute('alt', altText);\n    });\n    lastParagraph.remove();\n  }\n\n  // Add appropriate classes to pictures\n  if (pictures.length === 2) {\n    pictures.forEach((pic, i) => pic.parentNode.classList.add(CUSTOM_CLASSES.image[i], 'hero-banner-image'));\n  } else if (pictures.length === 1) {\n    pictures[0].parentNode.classList.add('hero-banner-image');\n  }\n\n  imageWrapper.append(...heroImage.childNodes);\n  return imageWrapper;\n}\n\nfunction addArrowIcon(bodyWrapper) {\n  const anchorTag = bodyWrapper.querySelector('a');\n  if (!anchorTag?.textContent?.trim()) return;\n\n  const iconSpan = document.createElement('span');\n  iconSpan.className = 'material-icons nsw-material-icons';\n  iconSpan.setAttribute('aria-hidden', 'true');\n  iconSpan.setAttribute('focusable', 'false');\n  iconSpan.textContent = 'east';\n\n  const iconDiv = document.createElement('div');\n  iconDiv.className = 'icon';\n  iconDiv.appendChild(iconSpan);\n  bodyWrapper.appendChild(iconDiv);\n  bodyWrapper.classList.add('hero__content--with-link');\n}\n\nexport default function decorate(block) {\n  const bodyWrapper = createWrapper('hero__content');\n  const blockRows = Array.from(block.children);\n  const { cardWrapper, cardContentWrapper } = createCardWrapper();\n\n  // Process content (first two rows)\n  handleTitle(blockRows[0], cardContentWrapper);\n  handleDescription(blockRows[1], cardContentWrapper);\n\n  // Process images (third row)\n  const imageWrapper = processImages(blockRows[2]);\n  imageWrapper.querySelectorAll('picture > img').forEach((img) => {\n    const optimizedPic = createOptimizedPicture(img.src, img.alt, false);\n    img.closest('picture').replaceWith(optimizedPic);\n  });\n  // Add arrow icon if needed\n  addArrowIcon(cardContentWrapper);\n\n  // Replace block content\n  block.innerHTML = '';\n  cardWrapper.appendChild(cardContentWrapper);\n  bodyWrapper.appendChild(cardWrapper);\n  block.append(bodyWrapper, imageWrapper);\n  const heroContent = block.querySelector('.hero__content');\n\n  if (heroContent) {\n    let resizeObserver;\n    let updateCount = 0;\n    let lastUpdateTime = 0;\n\n    const updateHeight = () => {\n      const currentTime = performance.now();\n\n      // If updates are happening too frequently, stop observing\n      if (updateCount > 1000) {\n        // eslint-disable-next-line no-console\n        console.warn('Hero content height update is being called too frequently');\n        resizeObserver.disconnect();\n        return;\n      }\n\n      // Check if update is happening too quickly\n      if (currentTime - lastUpdateTime < 100) {\n        updateCount += 1;\n      } else {\n        // Reset update tracking if it's been more than 100ms\n        updateCount = 1;\n      }\n\n      lastUpdateTime = currentTime;\n\n      const height = heroContent.offsetHeight;\n      document.documentElement.style.setProperty('--hero-content-height', `${height / 2}px`);\n    };\n\n    resizeObserver = new ResizeObserver(updateHeight);\n    resizeObserver.observe(heroContent);\n\n    // Initial height update after 100ms\n    setTimeout(updateHeight, 100);\n  }\n}\n"],"names":["CUSTOM_CLASSES","createWrapper","className","wrapper","createCardWrapper","cardWrapper","cardContentWrapper","handleTitle","titleRow","bodyWrapper","titleColumn","anchor","redirectUrl","titleEl","moveInstrumentation","handleDescription","descriptionRow","descriptionColumn","processImages","heroImage","imageWrapper","paragraphs","pictures","lastParagraph","p","altText","picture","_a","pic","i","addArrowIcon","anchorTag","iconSpan","iconDiv","decorate","block","blockRows","img","optimizedPic","createOptimizedPicture","heroContent","resizeObserver","updateCount","lastUpdateTime","updateHeight","currentTime","height"],"mappings":"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"}